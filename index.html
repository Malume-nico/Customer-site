<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>The Golden Feather ¬∑ farm fresh chicken</title>
    <!-- Font Awesome 6 (free) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ---------- base reset (unchanged) ---------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        }
        body {
            background: #f7f3eb;
            margin: 0;
            padding: 0;
            display: block;
        }
        .app {
            width: 100%;
            max-width: 420px;
            margin: 0 auto;
            background-color: #fefcf7;
            box-shadow: 0 0 30px rgba(0,0,0,0.05);
            min-height: 100vh;
            min-height: 100dvh;
            display: block;
            position: relative;
            border-left: 1px solid #e8dccd;
            border-right: 1px solid #e8dccd;
            border-bottom: none;
            border-top: none;
            box-sizing: border-box;
        }
        /* ===== HEADER fixed with user dropdown ===== */
        .header {
            padding: 0.5rem 1.2rem 0.6rem 1.2rem;
            background: #fefcf7;
            border-bottom: 2px solid #e0cfbb;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 420px;
            z-index: 1000;
            box-sizing: border-box;
            border-radius: 32px 32px 0 0;
            box-shadow: 0 6px 12px -6px rgba(90, 70, 40, 0.15);
            border-left: none;
            border-right: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.5px;
            color: #2c4532;
            display: flex;
            align-items: center;
            gap: 8px;
            line-height: 1.3;
            margin:0;
        }
        .main-feather {
            color: #c9a43b;
            font-size: 1.8rem;
            display: inline-block;
            animation: floatFall 4s ease-in-out infinite;
        }
        @keyframes floatFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.9; }
            25% { transform: translateY(-6px) rotate(-10deg); opacity: 1; }
            60% { transform: translateY(4px) rotate(7deg); opacity: 0.8; }
            100% { transform: translateY(0) rotate(0deg); opacity: 0.9; }
        }
        .user-menu {
            position: relative;
            cursor: pointer;
        }
        .user-icon {
            background: #2c4532;
            color: #f5e7d3;
            width: 42px;
            height: 42px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            border: 2px solid #c9a43b;
        }
        .user-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            border: 1px solid #e0cfbb;
            border-radius: 24px;
            width: 260px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            display: none;
            z-index: 1100;
            padding: 1rem;
        }
        .user-menu.active .user-dropdown {
            display: block;
        }
        .dropdown-item {
            padding: 0.7rem 0.5rem;
            border-bottom: 1px solid #f0e0ce;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }
        .dropdown-item:last-child {
            border-bottom: none;
        }
        .tagline {
            font-size: 0.7rem;
            color: #7e6b4b;
            margin-top: 2px;
        }
        /* ===== MAIN CONTENT ===== */
        .main-content {
            overflow: visible;
            display: block;
            padding: 1rem 1rem 0.8rem 1rem;
        }
        .content-section {
            display: none;
            flex-direction: column;
            gap: 1rem;
        }
        .content-section.active {
            display: flex;
        }
        /* cards (original styles) */
        .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 8px 16px -6px rgba(45, 40, 30, 0.1), 0 2px 4px rgba(0,0,0,0.03);
            padding: 1.2rem;
            border: 1px solid #f0e7da;
            transition: all 0.1s ease;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .badge {
            background: #dabf8e;
            color: #2d3f2a;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.3rem 0.9rem;
            border-radius: 30px;
            letter-spacing: 0.3px;
        }
        .badge.green {
            background: #3f6e4c;
            color: #f7f0e0;
        }
        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e2c;
        }
        .card-desc {
            color: #5e4e38;
            font-size: 0.9rem;
            line-height: 1.4;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .price {
            font-weight: 700;
            font-size: 1.5rem;
            color: #3f5c3a;
        }
        .price small { font-size: 0.9rem; font-weight: 400; color: #7a6850; }
        .growing-progress { background: #eee6d9; height: 8px; border-radius: 20px; margin: 6px 0 2px; }
        .progress-fill { width: 70%; height: 8px; background: #c9a43b; border-radius: 20px; }
        .row { display: flex; align-items: center; gap: 0.8rem; flex-wrap: wrap; }
        .btn {
            background: #2c4532;
            border: none;
            color: white;
            padding: 0.8rem 1.6rem;
            border-radius: 40px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 1px solid #1f311f;
            flex: 1 1 auto;
        }
        .btn-gold { background: #c9a43b; border-color: #a8862c; color: #1e2b1a; }
        .btn-outline { background: transparent; border: 1.5px solid #c9a43b; color: #4a3e2b; }
        .btn-small { padding: 0.5rem 1.2rem; font-size: 0.9rem; }
        .icon-green { color: #3f6e4c; }
        .bulk-calc { background: #f2ebe0; border-radius: 18px; padding: 1rem; margin-top: 0.5rem; }
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.8rem 0;
        }
        .quantity-selector button {
            width: 44px; height: 44px; border-radius: 50%; border: 1px solid #c0aa83; background: white;
            font-size: 1.4rem; font-weight: 600; color: #3f5c3a; cursor: pointer;
        }
        .quantity-selector input {
            width: 70px; text-align: center; font-size: 1.2rem; border: 1px solid #d4c0a3;
            border-radius: 30px; padding: 0.5rem; background: white;
        }
        /* bottom nav */
        .bottom-nav {
            background: #fefcf7;
            border-top: 1px solid #e8dccd;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0.4rem 0.2rem 0.2rem;
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 420px;
            z-index: 1000;
            box-sizing: border-box;
        }
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #a28d70;
            font-size: 0.7rem;
            font-weight: 500;
            padding: 0.3rem 0;
            border-radius: 20px;
            cursor: pointer;
            position: relative;
        }
        .nav-item i { font-size: 1.5rem; margin-bottom: 2px; }
        .nav-item.active { color: #2c4532; background: #ede7dc; }
        .badge-notify {
            position: absolute;
            top: 0;
            right: 10px;
            background: #c94f4f;
            color: white;
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            border-radius: 20px;
        }
        /* new styles for messages & support */
        .chat-bubble {
            background: #f0e7da;
            border-radius: 22px;
            padding: 0.8rem;
            margin: 0.5rem 0;
            max-width: 85%;
        }
        .chat-bubble.admin {
            background: #d4e3d0;
            margin-left: auto;
        }
        .chat-input-area {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .chat-input-area input {
            flex: 1;
            border: 1px solid #d4c0a3;
            border-radius: 40px;
            padding: 0.8rem 1rem;
        }
        .support-request {
            background: #faf3e8;
            border-radius: 18px;
            padding: 1rem;
            border-left: 6px solid;
        }
        .status-open { border-left-color: #d4a017; }
        .status-progress { border-left-color: #2c4532; }
        .status-resolved { border-left-color: #7e9f7e; }
        .star-rating i {
            color: #c9a43b;
            font-size: 1.6rem;
            cursor: pointer;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .modal-card {
            background: white;
            max-width: 350px;
            padding: 2rem;
            border-radius: 40px;
        }
        .show-modal { display: flex; }
        .byproducts-grid { display: grid; grid-template-columns: repeat(2,1fr); gap:0.8rem; }
        .byproduct-item { background: #f9f2e7; border-radius:20px; padding:0.8rem; text-align: center; }
        .hero-brand { background: linear-gradient(145deg, #fff7e8, #fce8cf); border-left: 8px solid #c9a43b; padding: 1.5rem 1.2rem; border-radius: 28px; }
        /* rewards extras */
        .gold-title { font-size:1.8rem; font-weight:700; color:#a96f2c; }
        .progress-container { background:#e6d9c0; border-radius:30px; height:16px; margin:0.8rem 0; }
        .progress-fill-reward { height:100%; background: linear-gradient(90deg, #dbb42c, #f5d742); border-radius:30px; width:0%; }
        .tier-cards-scroll { display:flex; gap:1rem; overflow-x:auto; padding:0.5rem 0.2rem; }
        .tier-card { min-width:140px; background:#f9f0e2; border-radius:30px; padding:1rem; border-left:6px solid; }
        .tier-card.bronze { border-color:#b87333; }
        .wallet-credit { background:#d4edc9; color:#1f4f1f; border-radius:40px; padding:0.5rem 1rem; }
        .flame-active i { color:#ff7b00; animation: flicker 0.8s infinite; }
        @keyframes flicker { 0% { opacity:1; } 50% { opacity:0.8; } 100% { opacity:1; } }
    </style>
</head>
<body>
<div class="app" id="appContainer">
    <!-- HEADER with user dropdown -->
    <div class="header">
        <h1><i class="fas fa-feather main-feather"></i> The Golden Feather</h1>
        <div class="user-menu" id="userMenu">
            <div class="user-icon" id="userMenuToggle"><i class="fas fa-user"></i></div>
            <div class="user-dropdown" id="userDropdown">
                <div class="dropdown-item"><i class="fas fa-circle-user" style="color:#2c4532;"></i> <strong>Alex Chen</strong> (member since 2024)</div>
                <div class="dropdown-item"><i class="fas fa-ticket-alt"></i> Loyalty points: <span id="loyaltyPointsDisplay">340</span></div>
                <div class="dropdown-item"><i class="fas fa-gift"></i> Voucher: <span id="voucherStatus">none</span></div>
                <div class="dropdown-item"><i class="fas fa-clock-rotate-left"></i> <a href="#" onclick="activateSection('ordersSection'); return false;">Purchase history ‚Üí</a></div>
                <div class="dropdown-item"><i class="fas fa-arrow-right-from-bracket"></i> Logout (simulated)</div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT (sections) -->
    <main class="main-content" id="mainContent">
        <!-- HOME section (contains all original purchase cards + book cards) -->
        <section id="homeSection" class="content-section active">
            <!-- Hero / brand card -->
            <div class="card hero-brand">
                <div class="hero-headline">Farm Fresh Chicken, Raised for Your Family</div>
                <div class="hero-subheadline">Trusted Local Poultry Supplier</div>
                <div class="hero-tagline">Fresh. Reliable. Always Available.</div>
                <div class="hero-trust"><i class="fas fa-hand-holding-heart"></i> We're your neighbors ‚Äî from our pasture to your table</div>
                <div class="hero-visuals" style="display:flex; gap:1.5rem; font-size:1.8rem; margin:0.8rem 0 0.2rem; color:#6f542e;">
                    <i class="fas fa-sun" style="color: #f5b342;"></i>
                    <i class="fas fa-leaf" style="color: #4e7f5a;"></i>
                    <i class="fas fa-tractor" style="color: #8b6b4d;"></i>
                    <i class="fas fa-heart" style="color: #c94f4f;"></i>
                </div>
                <div style="font-size: 0.8rem; color: #7e6b4b; margin-top: 6px;"><i class="far fa-clock"></i> harvested early morning ¬∑ always fresh</div>
            </div>
            <!-- Our promise card -->
            <div class="card brand-story">
                <div class="card-title" style="font-size: 1.3rem;">üïäÔ∏è Our promise</div>
                <p>We raise every chicken with care on open pastures, just minutes from your home. No freeze, no shortcuts ‚Äî only clean, honest poultry delivered within hours of harvest.</p>
                <p><i class="fas fa-people-group" style="color:#c9a43b;"></i> <strong>Community first:</strong> we supply local families, braais, and restaurants because we live here too. Freshness isn‚Äôt just our business ‚Äî it‚Äôs our table.</p>
            </div>
            <!-- Trust signals card -->
            <div class="card trust-signals">
                <div class="trust-grid" style="display: flex; flex-wrap: wrap; gap: 0.8rem; justify-content: center;">
                    <div class="trust-item" style="flex:1 0 calc(50% - 0.8rem); background: white; border-radius: 22px; padding: 0.9rem 0.2rem; text-align: center; border:1px solid #f0e0ce;"><i class="fas fa-check-circle"></i> Always fresh</div>
                    <div class="trust-item" style="flex:1 0 calc(50% - 0.8rem); background: white; border-radius: 22px; padding: 0.9rem 0.2rem; text-align: center; border:1px solid #f0e0ce;"><i class="fas fa-hand-sparkles"></i> Clean preparation</div>
                    <div class="trust-item" style="flex:1 0 calc(50% - 0.8rem); background: white; border-radius: 22px; padding: 0.9rem 0.2rem; text-align: center; border:1px solid #f0e0ce;"><i class="fas fa-clock"></i> Reliable availability</div>
                    <div class="trust-item" style="flex:1 0 calc(50% - 0.8rem); background: white; border-radius: 22px; padding: 0.9rem 0.2rem; text-align: center; border:1px solid #f0e0ce;"><i class="fas fa-tractor"></i> Local farm quality</div>
                </div>
            </div>
            <!-- Book cards (growing batches) integrated -->
            <div class="card">
                <div class="card-header"><span class="badge green"><i class="fas fa-seedling"></i> growing ¬∑ batch GC2405</span></div>
                <div class="card-title">üåø Herb infused ¬∑ 22 left</div>
                <div class="growing-progress"><div class="progress-fill" style="width:30%"></div></div>
                <div>ready 25 May ¬∑ deposit R33</div>
                <button class="btn btn-gold btn-small" onclick="alert('Reserved with 30% deposit')">reserve now</button>
            </div>
            <div class="card">
                <div class="card-header"><span class="badge green">organic ¬∑ batch GC2402</span></div>
                <div class="card-title">üåæ Ancient grains ¬∑ 8 left</div>
                <div class="growing-progress"><div class="progress-fill" style="width:90%"></div></div>
                <div>ready 3 days ¬∑ pre-order R110</div>
                <button class="btn btn-small" onclick="alert('Pre-order full amount 110')"><i class="fas fa-lock"></i> reserve now</button>
            </div>
            <!-- Food desire card -->
            <div class="card food-desire">
                <div style="font-weight: 600; margin-bottom: 0.4rem; color: #4f3f2b;"><i class="fas fa-utensils"></i> From our farm to your braai</div>
                <div class="desire-scroll" style="display: flex; gap: 1rem; overflow-x: auto; padding: 0.4rem 0.2rem 0.8rem;">
                    <div class="desire-item" style="min-width:100px; text-align:center;"><i class="fas fa-drumstick-bite"></i><br><span>Golden roast</span></div>
                    <div class="desire-item" style="min-width:100px; text-align:center;"><i class="fas fa-fire"></i><br><span>Braai special</span></div>
                    <div class="desire-item" style="min-width:100px; text-align:center;"><i class="fas fa-people-roof"></i><br><span>Family dinner</span></div>
                    <div class="desire-item" style="min-width:100px; text-align:center;"><i class="fas fa-store"></i><br><span>Restaurant supply</span></div>
                </div>
                <p style="font-size:0.9rem; margin-top:6px; color:#735f44;"><i class="fas fa-star"></i> Sunday braai? We've got the freshest birds.</p>
            </div>
            <!-- Monthly subscription teaser -->
            <div class="card" style="background: #f2ebe0;">
                <div class="card-header">
                    <span class="badge" style="background:#c9a43b; color:#1e2b1a;"><i class="fas fa-calendar-check"></i> monthly subscription</span>
                    <span class="badge green">save 6%</span>
                </div>
                <div class="card-title">üì¶ Never run out of fresh chicken</div>
                <div class="row" style="justify-content: center; gap: 0.3rem; flex-wrap: wrap;">
                    <span class="badge" style="background:#eddfcd;"><i class="fas fa-box"></i> Keep your chicken stock ready every month</span>
                    <span class="badge" style="background:#eddfcd;"><i class="fas fa-sliders-h"></i> Adjust your order anytime</span>
                    <span class="badge" style="background:#eddfcd;"><i class="fas fa-tags"></i> Save 6% with your monthly plan</span>
                </div>
                <p style="font-size:0.9rem; margin-top:6px;"><i class="fas fa-info-circle"></i> Minimum 3 chickens per subscription ¬∑ billed monthly ¬∑ cancel or modify with one tap</p>
            </div>
            <!-- TIER 1 BULK/BUNCH SUBSCRIPTION (original) -->
            <div class="card" id="tier1BulkCard">
                <div class="card-header">
                    <span class="badge" style="background:#2c4532; color:white;"><i class="fas fa-warehouse"></i> Tier 1 ¬∑ Bulk/Bunch</span>
                    <span class="badge" style="background:#c9a43b;">R75 / chicken ¬∑ no discount</span>
                </div>
                <div class="card-title">ü•© Bulk subscription for restaurants & Chisanyamas</div>
                <div class="row" style="justify-content: flex-start; gap: 0.3rem; flex-wrap: wrap; margin-bottom: 0.3rem;">
                    <span class="badge" style="background:#eddfcd;"><i class="fas fa-box"></i> Keep your daily stock ready</span>
                    <span class="badge" style="background:#eddfcd;"><i class="fas fa-sliders-h"></i> Adjust your daily delivery anytime</span>
                    <span class="badge" style="background:#eddfcd;"><i class="fas fa-calendar-alt"></i> Plan your month, get fresh chickens every day</span>
                </div>
                <label style="font-weight:600; margin-top:6px;">üìÜ Monthly total (minimum 3)</label>
                <div class="quantity-selector">
                    <button id="tier1MonthlyDec">‚àí</button>
                    <input type="number" id="tier1MonthlyQty" value="30" min="3" max="200" step="1">
                    <button id="tier1MonthlyInc">+</button>
                </div>
                <label style="font-weight:600; margin-top:6px;">üöö Daily delivery quantity (minimum 3)</label>
                <div class="quantity-selector">
                    <button id="tier1DailyDec">‚àí</button>
                    <input type="number" id="tier1DailyQty" value="3" min="3" max="200" step="1">
                    <button id="tier1DailyInc">+</button>
                </div>
                <p style="font-size:0.9rem; background:#f2ebe0; padding:0.5rem; border-radius:30px;">
                    <i class="fas fa-truck"></i> Approx. <span id="deliveriesPerMonth">10</span> deliveries this month ¬∑ billed monthly
                </p>
                <div style="display: flex; justify-content: space-between; align-items: baseline;">
                    <span class="price" style="font-size:1.2rem;">Monthly total:</span>
                    <span class="price" style="font-size:1.8rem;">R<span id="tier1MonthlyPrice">2250.00</span></span>
                </div>
                <div class="row" style="margin-top:6px;">
                    <button class="btn btn-gold" id="tier1SubscribeBtn"><i class="fas fa-calendar-plus"></i> subscribe monthly</button>
                    <button class="btn btn-outline btn-small" id="tier1ExtraBtn"><i class="fas fa-plus-circle"></i> request extra chickens</button>
                </div>
                <p style="font-size:0.75rem; color:#7e6b4b;"><i class="fas fa-redo-alt"></i> Next billing: 30 days ¬∑ cancel/modify anytime ¬∑ min. 3 per delivery</p>
            </div>
            <!-- Live Chicken Subscription -->
            <div class="card" id="subLiveCard">
                <div class="card-header">
                    <span class="badge"><i class="fas-regular fa-egg"></i> live ¬∑ subscription</span>
                    <i class="fas fa-leaf" style="color:#6f8f6d;"></i>
                </div>
                <div class="card-title">üêî Live Chicken ¬∑ Monthly</div>
                <div class="card-desc"><i class="fas fa-clock"></i> You receive live chickens ¬∑ no by‚Äëproducts</div>
                <div style="display: flex; gap: 0.5rem; align-items: baseline;">
                    <span class="price" style="font-size:1.3rem;">R<span id="subLivePerMonth">94.00</span> <small>/chicken</small></span>
                    <span style="text-decoration: line-through; color:#a28d70;">R100</span>
                    <span class="badge green">6% off</span>
                </div>
                <div class="quantity-selector">
                    <button class="subLiveDec">‚àí</button>
                    <input type="number" id="subLiveQty" class="subQty" value="3" min="3" max="50" step="1">
                    <button class="subLiveInc">+</button>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Total monthly:</span>
                    <span class="price" style="font-size:1.5rem;">R<span id="subLiveTotal">282.00</span></span>
                </div>
                <button class="btn btn-gold" onclick="handleSubscription()"><i class="fas fa-calendar-plus"></i> subscribe monthly</button>
                <p style="font-size:0.75rem; color:#7e6b4b;"><i class="fas fa-redo-alt"></i> Next billing: 30 days ¬∑ easy cancellation</p>
            </div>
            <!-- Standard Prep Subscription -->
            <div class="card" id="subStdCard">
                <div class="card-header">
                    <span class="badge green"><i class="fas fa-kitchen-set"></i> standard prep ¬∑ subscription</span>
                    <span class="badge">farm keeps by‚Äëproducts</span>
                </div>
                <div class="card-title">üî™ Standard Prep ¬∑ Monthly</div>
                <div class="card-desc"><i class="fas fa-utensils"></i> Cleaned, ready‚Äëto‚Äëcook ¬∑ farm retains feet, head, gizzards etc.</div>
                <div style="display: flex; gap: 0.5rem; align-items: baseline;">
                    <span class="price" style="font-size:1.3rem;">R<span id="subStdPerMonth">94.00</span> <small>/chicken</small></span>
                    <span style="text-decoration: line-through; color:#a28d70;">R100</span>
                    <span class="badge green">6% off</span>
                </div>
                <div class="quantity-selector">
                    <button class="subStdDec">‚àí</button>
                    <input type="number" id="subStdQty" class="subQty" value="3" min="3" max="50" step="1">
                    <button class="subStdInc">+</button>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Total monthly:</span>
                    <span class="price" style="font-size:1.5rem;">R<span id="subStdTotal">282.00</span></span>
                </div>
                <button class="btn btn-gold" onclick="handleSubscription()"><i class="fas fa-calendar-plus"></i> subscribe monthly</button>
                <p style="font-size:0.75rem; color:#7e6b4b;"><i class="fas fa-sliders-h"></i> Adjust quantity or cancel in one tap</p>
            </div>
            <!-- Premium Subscription -->
            <div class="card" id="subPremCard">
                <div class="card-header">
                    <span class="badge" style="background:#c9a43b; color:#1e2b1a;"><i class="fas fa-crown"></i> premium ¬∑ subscription</span>
                </div>
                <div class="card-title">üçó Premium Fully Prepared ¬∑ Monthly</div>
                <div class="card-desc"><i class="fas fa-check-circle"></i> Includes all parts (feet, gizzards, liver, heart, etc.)</div>
                <div style="display: flex; gap: 0.5rem; align-items: baseline;">
                    <span class="price" style="font-size:1.3rem;">R<span id="subPremPerMonth">108.10</span> <small>/chicken</small></span>
                    <span style="text-decoration: line-through; color:#a28d70;">R115</span>
                    <span class="badge green">6% off</span>
                </div>
                <div class="quantity-selector">
                    <button class="subPremDec">‚àí</button>
                    <input type="number" id="subPremQty" class="subQty" value="3" min="3" max="50" step="1">
                    <button class="subPremInc">+</button>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Total monthly:</span>
                    <span class="price" style="font-size:1.5rem;">R<span id="subPremTotal">324.30</span></span>
                </div>
                <button class="btn btn-gold" onclick="handleSubscription()"><i class="fas fa-calendar-plus"></i> subscribe monthly</button>
                <p style="font-size:0.75rem; color:#7e6b4b;"><i class="fas fa-calendar-alt"></i> Billed monthly ¬∑ upgrade/downgrade anytime</p>
            </div>
            <!-- One-time purchase cards (live, standard, premium) -->
            <div class="card">
                <div class="card-header">
                    <span class="badge"><i class="fas fa-egg"></i> live bird</span>
                    <i class="fas fa-leaf" style="color:#6f8f6d;"></i>
                </div>
                <div class="card-title">üêî Whole Live Chicken</div>
                <div class="card-desc"><i class="fas fa-clock"></i> you receive live chicken ¬∑ no by‚Äëproducts</div>
                <div class="price">R100 <small>per chicken</small></div>
                <div class="row">
                    <button class="btn btn-small one-time-purchase" data-quantity="1" data-type="live"><i class="fas fa-cart-plus"></i> quick buy</button>
                    <button class="btn btn-outline btn-small one-time-purchase" data-quantity="1" data-type="live"><i class="fas fa-redo-alt"></i> reorder</button>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="badge green"><i class="fas fa-kitchen-set"></i> standard prep</span>
                    <span class="badge">by‚Äëproducts kept</span>
                </div>
                <div class="card-title">üî™ Standard Prepared Chicken</div>
                <div class="card-desc"><i class="fas fa-utensils"></i> cleaned & ready‚Äëto‚Äëcook</div>
                <div class="price">R100 <small>per chicken</small></div>
                <p style="font-size:0.85rem; background:#f6ede1; padding:0.4rem; border-radius:30px; color:#5f4e36;">
                    <i class="fas fa-separator"></i> Farm retains: feet, head/neck, gizzards, liver, heart, intestines ‚Äî sold separately below.
                </p>
                <div class="row">
                    <button class="btn btn-small one-time-purchase" data-quantity="1" data-type="standard"><i class="fas fa-cart-plus"></i> buy</button>
                    <button class="btn btn-outline btn-small one-time-purchase" data-quantity="1" data-type="standard"><i class="fas fa-redo-alt"></i> reorder</button>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="badge" style="background:#c9a43b; color:#1e2b1a;"><i class="fas fa-crown"></i> premium</span>
                </div>
                <div class="card-title">üçó Premium Fully Prepared</div>
                <div class="card-desc"><i class="fas fa-check-circle"></i> includes all parts (feet, gizzards, liver, heart, etc.)</div>
                <div class="price">R115 <small>per chicken ¬∑ everything included</small></div>
                <div class="row">
                    <button class="btn btn-gold btn-small one-time-purchase" data-quantity="1" data-type="premium"><i class="fas fa-cart-plus"></i> buy premium</button>
                    <button class="btn btn-outline btn-small one-time-purchase" data-quantity="1" data-type="premium"><i class="fas fa-redo-alt"></i> reorder</button>
                </div>
            </div>
            <!-- Bulk Buyer Option (min 10, R75 each) -->
            <div class="card">
                <div class="card-header">
                    <span class="badge green"><i class="fas fa-users"></i> bulk 10+</span>
                    <span class="badge">restaurants / resellers</span>
                </div>
                <div class="card-title">üì¶ Bulk Buyer (minimum 10)</div>
                <div class="card-desc"><i class="fas fa-tag icon-green"></i> R75 per chicken ¬∑ farm keeps all by‚Äëproducts</div>
                <div class="bulk-calc" style="margin-top:0;">
                    <label>Quantity (min. 10 for bulk rate)</label>
                    <div class="quantity-selector">
                        <button class="bulkOptionDec">‚àí</button>
                        <input type="number" class="bulkOptionQty" value="10" min="10" max="200" step="1">
                        <button class="bulkOptionInc">+</button>
                    </div>
                    <p style="font-size:1.2rem; font-weight:600;">Total: R<span class="bulkOptionTotal">750</span></p>
                    <p><span class="bulkOptionUnit">R75 / chicken</span></p>
                </div>
                <div class="row">
                    <button class="btn btn-small bulk-purchase" data-type="bulk"><i class="fas fa-truck"></i> order bulk</button>
                    <button class="btn btn-outline btn-small bulk-purchase" data-type="bulk"><i class="fas fa-redo-alt"></i> reorder</button>
                </div>
            </div>
            <!-- By‚Äëproducts grid -->
            <div class="card">
                <div class="card-header">
                    <span class="badge" style="background:#3f6e4c; color:white;"><i class="fas fa-boxes-stacked"></i> farm by‚Äëproducts</span>
                    <span class="freezer-badge"><i class="fas fa-snowflake"></i> frozen storage</span>
                </div>
                <div class="card-title">üçó Feet ¬∑ Gizzards ¬∑ Liver & more</div>
                <p class="card-desc">Packaged separately from our standard prep chickens. Always available frozen or fresh.</p>
                <div class="byproducts-grid">
                    <div class="byproduct-item">
                        <i class="fas fa-paw"></i>
                        <div class="byproduct-name">Chicken feet</div>
                        <div class="byproduct-price">R15 / pack</div>
                        <button onclick="alert('üõí Added chicken feet pack (R15)')"><i class="fas fa-cart-plus"></i> add</button>
                    </div>
                    <div class="byproduct-item">
                        <i class="fas fa-drumstick-bite"></i>
                        <div class="byproduct-name">Heads & necks</div>
                        <div class="byproduct-price">R10 / pack</div>
                        <button onclick="alert('üõí Added heads & necks pack (R10)')"><i class="fas fa-cart-plus"></i> add</button>
                    </div>
                    <div class="byproduct-item">
                        <i class="fas fa-utensils"></i>
                        <div class="byproduct-name">Gizzards</div>
                        <div class="byproduct-price">R20 / pack</div>
                        <button onclick="alert('üõí Added gizzards pack (R20)')"><i class="fas fa-cart-plus"></i> add</button>
                    </div>
                    <div class="byproduct-item">
                        <i class="fas fa-heart"></i>
                        <div class="byproduct-name">Liver</div>
                        <div class="byproduct-price">R15 / pack</div>
                        <button onclick="alert('üõí Added liver pack (R15)')"><i class="fas fa-cart-plus"></i> add</button>
                    </div>
                    <div class="byproduct-item">
                        <i class="fas fa-heartbeat"></i>
                        <div class="byproduct-name">Heart</div>
                        <div class="byproduct-price">R15 / pack</div>
                        <button onclick="alert('üõí Added heart pack (R15)')"><i class="fas fa-cart-plus"></i> add</button>
                    </div>
                    <div class="byproduct-item">
                        <i class="fas fa-circle"></i>
                        <div class="byproduct-name">Intestines</div>
                        <div class="byproduct-price">R10 / pack</div>
                        <button onclick="alert('üõí Added intestines pack (R10)')"><i class="fas fa-cart-plus"></i> add</button>
                    </div>
                </div>
                <p style="font-size:0.8rem; color:#735f44; margin-top:6px;"><i class="fas fa-snowflake"></i> All by‚Äëproducts available frozen ‚Äî select at checkout.</p>
                <button class="btn-outline btn-small" style="width:100%;" onclick="alert('üõí View all by‚Äëproducts in cart')">go to by‚Äëproducts cart</button>
            </div>
            <!-- Loyalty feather card -->
            <div class="card" style="background:#fff6e9;">
                <div class="row">
                    <i class="fas fa-gem" style="color:#c9a43b; font-size:2rem;"></i>
                    <span><strong>Loyalty feather</strong> ¬∑ refer a friend, get 10% off</span>
                </div>
                <button class="btn-outline btn-small" style="width:100%;" onclick="alert('üîó share referral link')"><i class="fas fa-share-alt"></i> invite & earn</button>
            </div>
            <!-- Subscription management card -->
            <div class="card" style="background:#faf3e8; border:2px dashed #c9a43b;">
                <div class="card-header">
                    <span class="badge" style="background:#2c4532; color:white;"><i class="fas fa-credit-card"></i> your subscription</span>
                </div>
                <div class="card-title">‚öôÔ∏è Manage monthly plan</div>
                <p style="font-size:0.9rem;">Upgrade, downgrade or cancel with one tap ‚Äî no questions asked.</p>
                <div class="row" style="justify-content: center;">
                    <button class="btn-small btn-outline" onclick="alert('üîÅ Upgrade to more chickens or a different tier. New price will apply next billing.')"><i class="fas fa-arrow-up"></i> upgrade</button>
                    <button class="btn-small btn-outline" onclick="alert('üîÅ Downgrade to fewer chickens or switch tier. Changes reflect next cycle.')"><i class="fas fa-arrow-down"></i> downgrade</button>
                    <button class="btn-small btn-outline" style="border-color:#b65151; color:#b65151;" onclick="if(confirm('Cancel your monthly subscription? You can resubscribe anytime.')) alert('Subscription cancelled. We‚Äôre sorry to see you go!')"><i class="fas fa-times"></i> cancel</button>
                </div>
                <p style="font-size:0.8rem; margin-top:6px;"><i class="fas fa-clock"></i> Changes take effect next billing cycle.</p>
            </div>
        </section>

        <!-- ORDERS section (with rating buttons) -->
        <section id="ordersSection" class="content-section">
            <div class="order-item" style="background:#f9f3ea; border-radius:18px; padding:1rem; border-left:6px solid #c9a43b;">
                <div><strong>#GC2341</strong> ¬∑ 5 chickens <span style="float:right;">ready 4 May</span></div>
                <div style="color:#8b764f;">paid ¬∑ pickup scheduled</div>
                <button class="btn-small btn-outline rate-order-btn" data-order="GC2341" style="margin-top:6px;"><i class="fas fa-star"></i> rate delivery</button>
            </div>
            <div class="order-item" style="background:#f9f3ea; border-radius:18px; padding:1rem; border-left:6px solid #c9a43b;">
                <div><strong>#GC2388</strong> ¬∑ 12 chickens (bulk) <span style="float:right;">8 May</span></div>
                <div style="color:#8b764f;">deposit paid ¬∑ growing</div>
            </div>
            <div class="order-item" style="background:#f9f3ea; border-radius:18px; padding:1rem; border-left:6px solid #c9a43b;">
                <div><strong>#GC2250</strong> ¬∑ 2 chickens <span style="float:right;">delivered 20 Apr</span></div>
                <div><i class="fas fa-star" style="color:gold;"></i> rate your purchase</div>
                <button class="btn-small btn-outline rate-order-btn" data-order="GC2250"><i class="fas fa-star"></i> rate</button>
            </div>
        </section>

        <!-- REWARDS section (enhanced) -->
        <section id="rewardsSection" class="content-section">
            <div class="card rewards-header">
                <div class="gold-title">Golden Rewards</div>
                <div style="font-size:0.95rem; color:#6b4f2a;">Earn more every time you buy</div>
                <div class="row" style="justify-content:space-between;">
                    <span><i class="fas fa-chicken"></i> <span id="oneTimeCountDisplay">3</span>/10 chickens</span>
                    <span class="countdown-badge"><i class="far fa-clock"></i> 45d left</span>
                </div>
                <div class="progress-container">
                    <div id="challengeProgress" class="progress-fill-reward" style="width:30%;"></div>
                </div>
                <div id="claimRewardBlock" style="display:none; margin-top:0.5rem;">
                    <button class="btn btn-gold" id="claimRewardBtn" style="width:100%;"><i class="fas fa-gift"></i> Claim 10% voucher</button>
                </div>
            </div>
            <div class="card">
                <div><i class="fas fa-piggy-bank"></i> Loyalty points: <span id="totalPoints">340</span> (R3.40 value)</div>
                <div>Next purchase discount: <span id="projectedDiscount">5%</span></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="badge green">Lifetime tier</span>
                    <span id="currentTierBadge">Bronze</span>
                </div>
                <p><span id="lifetimeChickens">12</span> lifetime chickens ¬∑ <span id="chickensToNextTier">8</span> to silver</p>
                <div class="tier-cards-scroll">
                    <div class="tier-card bronze"><strong>Bronze</strong> 0-19</div>
                    <div class="tier-card silver"><strong>Silver</strong> 20-49</div>
                    <div class="tier-card gold"><strong>Gold</strong> 50-99</div>
                    <div class="tier-card platinum"><strong>Platinum</strong> 100+</div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="badge"><i class="fas fa-fire"></i> Streak</span>
                    <span class="flame-active"><i class="fas fa-fire"></i> <span id="streakCount">2</span> weeks</span>
                </div>
                <p>Buy at least 1 chicken per week to maintain streak. 4 weeks = small reward.</p>
                <div id="streakRewardBlock" style="display:none;"><button class="btn-small btn-outline">Claim free by-product</button></div>
            </div>
            <div class="card wallet-credit">
                <div><i class="fas fa-user-plus"></i> Referral program</div>
                <p>You've referred <span id="referralCount">1</span> friends ¬∑ 5% credit in wallet: R<span id="walletCredit">5.00</span></p>
                <button class="btn-small btn-outline" onclick="alert('Share your referral link')"><i class="fas fa-share"></i> invite</button>
            </div>
        </section>

        <!-- MESSAGES section (chat) -->
        <section id="messagesSection" class="content-section">
            <div class="card">
                <div class="card-header"><span class="badge"><i class="fas fa-comment"></i> Chat with farmer</span> <span class="badge green" id="unreadBadge" style="display:none;">new</span></div>
                <div id="chatMessages" style="max-height:300px; overflow-y:auto; display:flex; flex-direction:column; gap:6px;">
                    <div class="chat-bubble admin">Hi Alex! Your order #GC2388 is growing well üå±</div>
                    <div class="chat-bubble">Thanks for the update!</div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="Type a message...">
                    <button class="btn-small btn-gold" id="sendChatBtn"><i class="fas fa-paper-plane"></i></button>
                </div>
                <p style="font-size:0.75rem;"><i class="fas fa-circle-info"></i> Admin typically replies within 2 hours</p>
            </div>
        </section>

        <!-- SUPPORT section (tickets & requests) -->
        <section id="supportSection" class="content-section">
            <div class="card">
                <div class="card-header"><span class="badge">üìã open a request</span></div>
                <select id="requestType" style="padding:0.5rem; border-radius:30px; border:1px solid #d4c0a3; margin-bottom:0.5rem;">
                    <option>Complaint</option><option>Refund</option><option>Query</option>
                </select>
                <select id="relatedPurchase" style="padding:0.5rem; border-radius:30px; border:1px solid #d4c0a3; margin-bottom:0.5rem;">
                    <option>#GC2341 (5 chickens)</option><option>#GC2388 (12 bulk)</option>
                </select>
                <textarea id="requestDesc" placeholder="Describe your issue..." rows="2" style="border:1px solid #d4c0a3; border-radius:20px; padding:0.7rem;"></textarea>
                <button class="btn btn-small" id="submitRequestBtn" style="margin-top:0.5rem;">submit</button>
            </div>
            <div class="card">
                <div class="card-header"><span class="badge">üìå my requests</span></div>
                <div id="requestsList">
                    <div class="support-request status-progress">#TKT001 ¬∑ Refund request ¬∑ In progress ¬∑ 2 messages</div>
                </div>
            </div>
            <!-- ratings summary (private) -->
            <div class="card">
                <div class="card-header"><span class="badge">‚≠ê my ratings & admin feedback</span></div>
                <div>Order #GC2250: 5 stars ¬∑ ‚ÄúGreat chicken!‚Äù ¬∑ Admin: thank you!</div>
            </div>
        </section>
    </main>

    <!-- BOTTOM NAV: Home, Orders, Rewards, Messages, Support -->
    <nav class="bottom-nav">
        <div class="nav-item active" data-section="homeSection"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="nav-item" data-section="ordersSection"><i class="fas fa-clipboard-list"></i><span>Orders</span></div>
        <div class="nav-item" data-section="rewardsSection"><i class="fas fa-gift"></i><span>Rewards</span></div>
        <div class="nav-item" data-section="messagesSection"><i class="fas fa-comment"></i><span>Messages</span><span class="badge-notify" id="messagesNotify" style="display:none;">1</span></div>
        <div class="nav-item" data-section="supportSection"><i class="fas fa-headset"></i><span>Support</span><span class="badge-notify" id="supportNotify" style="display:none;">1</span></div>
    </nav>

    <!-- Rating modal -->
    <div class="modal-overlay" id="ratingModal">
        <div class="modal-card">
            <h3>Rate your order</h3>
            <div class="star-rating" id="starRatingWidget">
                <i class="far fa-star" data-star="1"></i><i class="far fa-star" data-star="2"></i><i class="far fa-star" data-star="3"></i><i class="far fa-star" data-star="4"></i><i class="far fa-star" data-star="5"></i>
            </div>
            <textarea id="privateFeedback" placeholder="Private feedback (only visible to admin)" rows="3" style="width:100%; border:1px solid #d4c0a3; border-radius:20px; padding:0.5rem;"></textarea>
            <button class="btn-small btn-gold" id="submitRatingBtn" style="margin-top:0.5rem;">submit</button>
            <button class="btn-small btn-outline" onclick="document.getElementById('ratingModal').classList.remove('show-modal')">close</button>
        </div>
    </div>
</div>

<script>
    (function() {
        // ---------- navigation ----------
        const navItems = document.querySelectorAll('.nav-item');
        const sections = {
            homeSection: document.getElementById('homeSection'),
            ordersSection: document.getElementById('ordersSection'),
            rewardsSection: document.getElementById('rewardsSection'),
            messagesSection: document.getElementById('messagesSection'),
            supportSection: document.getElementById('supportSection')
        };
        function activateSection(sectionId) {
            Object.values(sections).forEach(s => s?.classList.remove('active'));
            if (sections[sectionId]) sections[sectionId].classList.add('active');
            navItems.forEach(item => item.classList.toggle('active', item.dataset.section === sectionId));
        }
        navItems.forEach(item => item.addEventListener('click', () => activateSection(item.dataset.section)));
        window.activateSection = activateSection; // for header link

        // ---------- user dropdown ----------
        const userMenu = document.getElementById('userMenu');
        document.getElementById('userMenuToggle').addEventListener('click', (e) => {
            e.stopPropagation();
            userMenu.classList.toggle('active');
        });
        document.addEventListener('click', () => userMenu.classList.remove('active'));

        // ---------- rewards state (unified counters) ----------
        let challengeCount = 3;          // 10-chicken challenge progress
        let lifetimeCount = 12;
        let loyaltyPoints = 340;
        let referralCount = 1;
        let walletCredit = 5.00;
        let weeklyStreak = 2;
        let messagesUnread = 1;
        let supportUnread = 1;

        function updateRewardsUI() {
            document.getElementById('oneTimeCountDisplay').innerText = challengeCount;
            let pct = Math.min(100, (challengeCount/10)*100);
            document.getElementById('challengeProgress').style.width = pct+'%';
            document.getElementById('claimRewardBlock').style.display = challengeCount>=10 ? 'block' : 'none';
            document.getElementById('totalPoints').innerText = loyaltyPoints;
            document.getElementById('lifetimeChickens').innerText = lifetimeCount;
            // tier logic
            let tier = 'Bronze', next = 20 - lifetimeCount;
            if (lifetimeCount >= 100) { tier='Platinum'; next=0; }
            else if (lifetimeCount >= 50) { tier='Gold'; next=100-lifetimeCount; }
            else if (lifetimeCount >= 20) { tier='Silver'; next=50-lifetimeCount; }
            document.getElementById('currentTierBadge').innerText = tier;
            document.getElementById('chickensToNextTier').innerText = next>0?next:0;
            document.getElementById('referralCount').innerText = referralCount;
            document.getElementById('walletCredit').innerText = walletCredit.toFixed(2);
            document.getElementById('streakCount').innerText = weeklyStreak;
            // notifications
            document.getElementById('messagesNotify').style.display = messagesUnread ? 'inline-block' : 'none';
            document.getElementById('supportNotify').style.display = supportUnread ? 'inline-block' : 'none';
            // loyalty points in header dropdown
            document.getElementById('loyaltyPointsDisplay').innerText = loyaltyPoints;
            document.getElementById('voucherStatus').innerText = challengeCount>=10 ? '10% ready' : 'none';
        }
        updateRewardsUI();

        // ---------- purchase handlers (all increment rewards) ----------
        function handleAnyPurchase(quantity, isBulk=false) {
            lifetimeCount += quantity;
            challengeCount += quantity;   // for demo, every chicken counts toward challenge (including bulk)
            loyaltyPoints += quantity * 10;
            weeklyStreak += 1;
            if (weeklyStreak > 4) weeklyStreak = 4; // cap
            updateRewardsUI();
            alert(`Purchased ${quantity} chicken(s) ¬∑ rewards updated!`);
        }

        // one-time purchase buttons
        document.querySelectorAll('.one-time-purchase').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                let qty = 1;
                const card = btn.closest('.card');
                const qtyInput = card?.querySelector('input[type="number"]');
                if (qtyInput) qty = parseInt(qtyInput.value) || 1;
                handleAnyPurchase(qty);
            });
        });

        // bulk purchase buttons
        document.querySelectorAll('.bulk-purchase').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const card = btn.closest('.card');
                const qtyInput = card?.querySelector('.bulkOptionQty');
                let qty = qtyInput ? parseInt(qtyInput.value) : 10;
                handleAnyPurchase(qty);
            });
        });

        // subscription buttons (mock)
        window.handleSubscription = function() { 
            alert('Subscribed! 3 chickens added to rewards');
            handleAnyPurchase(3);
        };

        // tier1 subscribe button
        document.getElementById('tier1SubscribeBtn')?.addEventListener('click', () => {
            let monthly = parseInt(document.getElementById('tier1MonthlyQty')?.value || 30);
            handleAnyPurchase(monthly);
        });

        // Tier 1 quantity handlers (copied from original)
        const tier1MonthlyQty = document.getElementById('tier1MonthlyQty');
        const tier1DailyQty = document.getElementById('tier1DailyQty');
        const tier1MonthlyPrice = document.getElementById('tier1MonthlyPrice');
        const deliveriesSpan = document.getElementById('deliveriesPerMonth');
        const TIER1_PRICE = 75;
        function updateTier1() {
            let monthly = parseInt(tier1MonthlyQty.value, 10) || 30;
            let daily = parseInt(tier1DailyQty.value, 10) || 3;
            monthly = Math.min(200, Math.max(3, monthly));
            daily = Math.min(200, Math.max(3, daily));
            if (daily > monthly) daily = monthly;
            tier1MonthlyQty.value = monthly;
            tier1DailyQty.value = daily;
            tier1MonthlyPrice.innerText = (monthly * TIER1_PRICE).toFixed(2);
            let deliveries = Math.floor(monthly / daily) || 1;
            deliveriesSpan.innerText = deliveries;
        }
        document.getElementById('tier1MonthlyDec')?.addEventListener('click', () => { tier1MonthlyQty.value = Math.max(3, parseInt(tier1MonthlyQty.value)-1); updateTier1(); });
        document.getElementById('tier1MonthlyInc')?.addEventListener('click', () => { tier1MonthlyQty.value = Math.min(200, parseInt(tier1MonthlyQty.value)+1); updateTier1(); });
        document.getElementById('tier1DailyDec')?.addEventListener('click', () => { tier1DailyQty.value = Math.max(3, parseInt(tier1DailyQty.value)-1); updateTier1(); });
        document.getElementById('tier1DailyInc')?.addEventListener('click', () => { tier1DailyQty.value = Math.min(200, parseInt(tier1DailyQty.value)+1); updateTier1(); });
        tier1MonthlyQty?.addEventListener('input', updateTier1);
        tier1DailyQty?.addEventListener('input', updateTier1);
        updateTier1();

        // Live subscription handlers
        function setupSub(className, priceId, totalId, qtyId) {
            const dec = document.querySelector(className+'Dec');
            const inc = document.querySelector(className+'Inc');
            const qty = document.getElementById(qtyId);
            const totalSpan = document.getElementById(totalId);
            const pricePer = parseFloat(document.getElementById(priceId)?.innerText) || 94;
            function update() {
                let v = parseInt(qty.value,10) || 3;
                v = Math.min(50, Math.max(3, v));
                qty.value = v;
                totalSpan.innerText = (v * pricePer).toFixed(2);
            }
            if (dec && inc && qty) {
                dec.addEventListener('click', () => { qty.value = Math.max(3, parseInt(qty.value)-1); update(); });
                inc.addEventListener('click', () => { qty.value = Math.min(50, parseInt(qty.value)+1); update(); });
                qty.addEventListener('input', update);
                update();
            }
        }
        setupSub('.subLive', 'subLivePerMonth', 'subLiveTotal', 'subLiveQty');
        setupSub('.subStd', 'subStdPerMonth', 'subStdTotal', 'subStdQty');
        setupSub('.subPrem', 'subPremPerMonth', 'subPremTotal', 'subPremQty');

        // ---------- chat simulation ----------
        const chatDiv = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        document.getElementById('sendChatBtn').addEventListener('click', () => {
            let msg = chatInput.value.trim();
            if (!msg) return;
            let userBubble = document.createElement('div');
            userBubble.className = 'chat-bubble';
            userBubble.innerText = msg;
            chatDiv.appendChild(userBubble);
            chatInput.value = '';
            messagesUnread = 0;
            updateRewardsUI();
            // simulate admin auto-reply after 1 sec
            setTimeout(() => {
                let adminBubble = document.createElement('div');
                adminBubble.className = 'chat-bubble admin';
                adminBubble.innerText = 'Thanks for your message, we‚Äôll get back to you soon.';
                chatDiv.appendChild(adminBubble);
                messagesUnread = 1;
                updateRewardsUI();
            }, 1000);
        });

        // ---------- support ticket submission ----------
        document.getElementById('submitRequestBtn').addEventListener('click', () => {
            let type = document.getElementById('requestType').value;
            let order = document.getElementById('relatedPurchase').value;
            let desc = document.getElementById('requestDesc').value;
            if (!desc) return alert('Please describe your issue');
            alert(`Ticket submitted: ${type} for ${order}. We'll respond within 24h.`);
            supportUnread = 1;
            updateRewardsUI();
            // add dummy request to list
            let reqList = document.getElementById('requestsList');
            let newReq = document.createElement('div');
            newReq.className = 'support-request status-open';
            newReq.innerText = `#TKT00${Date.now()} ¬∑ ${type} ¬∑ Open ¬∑ 0 messages`;
            reqList.appendChild(newReq);
            document.getElementById('requestDesc').value = '';
        });

        // ---------- rating modal ----------
        const modal = document.getElementById('ratingModal');
        let currentOrder = '';
        document.querySelectorAll('.rate-order-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                currentOrder = btn.dataset.order;
                modal.classList.add('show-modal');
            });
        });
        let selectedRating = 0;
        document.querySelectorAll('.star-rating i').forEach(star => {
            star.addEventListener('click', (e) => {
                selectedRating = parseInt(star.dataset.star);
                document.querySelectorAll('.star-rating i').forEach((s,idx) => {
                    if (idx < selectedRating) s.classList.replace('far','fas');
                    else s.classList.replace('fas','far');
                });
            });
        });
        document.getElementById('submitRatingBtn').addEventListener('click', () => {
            let feedback = document.getElementById('privateFeedback').value;
            alert(`Rating ${selectedRating} stars submitted for ${currentOrder}. Private feedback recorded.`);
            modal.classList.remove('show-modal');
            // reset
            selectedRating = 0;
            document.querySelectorAll('.star-rating i').forEach(s => s.classList.replace('fas','far'));
            document.getElementById('privateFeedback').value = '';
        });

        // ---------- claim reward ----------
        document.getElementById('claimRewardBtn')?.addEventListener('click', () => {
            if (challengeCount >= 10) {
                alert('üéâ 10% voucher claimed! (valid 60 days)');
                challengeCount = 0;
                updateRewardsUI();
            }
        });

        // ---------- padding adjustment ----------
        function setAppPadding() {
            const app = document.querySelector('.app');
            const header = document.querySelector('.header');
            const bottomNav = document.querySelector('.bottom-nav');
            if (app && header && bottomNav) {
                app.style.paddingTop = header.offsetHeight + 'px';
                app.style.paddingBottom = bottomNav.offsetHeight + 'px';
            }
        }
        window.addEventListener('load', setAppPadding);
        window.addEventListener('resize', setAppPadding);
        setTimeout(setAppPadding, 100);
    })();
</script>
</body>
</html>